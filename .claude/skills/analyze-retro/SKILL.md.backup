---
name: analyze-retro
description:
  Analisa m√©tricas de retrospectiva e gera report.md completo. 
  Use quando o usu√°rio pedir para analisar retrospectiva ou gerar relat√≥rio.
  Assume que os gr√°ficos PNG j√° foram gerados previamente.
  Requer time, quarter e data da retrospectiva.
allowed-tools: Read, Write, Glob, AskUserQuestion
---

# Analisar Retrospectiva e Gerar Relat√≥rio

## Responsabilidade

Esta skill **analisa m√©tricas de retrospectiva** e gera o relat√≥rio completo. Ela:

- ‚úÖ Valida presen√ßa de arquivos CSV (cfd, throughput, leadtime, tickets)
- ‚úÖ Valida presen√ßa de gr√°ficos PNG (cfd, throughput, leadtime, tickets)
- ‚úÖ Analisa estat√≠sticas (m√©dias, medianas, percentis, tend√™ncias)
- ‚úÖ Cria `report.md` baseado no Template.md com PNGs embutidos
- ‚úÖ Suporta an√°lises parciais e incrementais

## ‚ö†Ô∏è  Pr√©-requisito

**Esta skill ASSUME que os gr√°ficos PNG j√° foram gerados.**

Para gerar gr√°ficos, execute antes:
```bash
python3 generate_metrics_charts.py [caminho-retrospectiva]
```

Ou use o `retro-wizard.py` que executa tudo automaticamente.

## Informa√ß√µes Obrigat√≥rias

Voc√™ **DEVE** coletar estas 3 informa√ß√µes antes de prosseguir:

### 1. Nome do Time

**Exemplo:** `financeiro`, `produto`, `infra`

### 2. Quarter

**Exemplo:** `2025-Q4`, `2026-Q1`

### 3. Data da Retrospectiva

**Exemplo:** `2025-12-19`, `2026-01-07`

### SE o usu√°rio N√ÉO informar:

Use `Glob` para encontrar as retrospectivas mais recentes e sugira ao usu√°rio.

## Workflow de An√°lise

### Passo 1: Identificar o caminho da retrospectiva

```
Caminho: [time]/[YYYY-QN]/[YYYY-MM-DD]/
Exemplo: financeiro/2025-Q4/2025-12-19/
```

### Passo 2: Validar arquivos CSV

Verificar presen√ßa dos 4 arquivos esperados usando `Glob`:

- `cfd.csv`
- `throughput.csv`
- `leadtime.csv`
- `tickets.csv`

**Casos:**

#### Caso 2.1: Nenhum CSV encontrado

```
‚ùå N√£o foi poss√≠vel continuar.

Nenhum arquivo CSV foi encontrado em: [caminho]

Para gerar o relat√≥rio, √© necess√°rio pelo menos um dos seguintes arquivos:
‚Ä¢ cfd.csv - Diagrama de Fluxo Cumulativo
‚Ä¢ throughput.csv - M√©tricas de vaz√£o
‚Ä¢ leadtime.csv - Distribui√ß√£o de lead time
‚Ä¢ tickets.csv - Exporta√ß√£o de tickets do Jira

Por favor, adicione os arquivos CSV e tente novamente.
```

**FINALIZAR processo.**

#### Caso 2.2: CSVs parciais encontrados

Use `AskUserQuestion` para perguntar se quer continuar com an√°lise parcial.

Se "N√£o" ‚Üí FINALIZAR processo. Se "Sim" ‚Üí Continuar para Passo 3.

#### Caso 2.3: Todos os CSVs encontrados

Continuar para Passo 3.

### Passo 3: Ler e processar CSVs

Para cada CSV dispon√≠vel, usar `Read` para carregar os dados e calcular m√©tricas estat√≠sticas.

#### Processamento de Dados

**CFD (cfd.csv):**

- Parsear CSV manualmente (split por v√≠rgula)
- Colunas t√≠picas: `Date`, `TESTING`, `READY TO TEST`, `CODE REVIEW`,
  `IN PROGRESS`
- Colunas opcionais: `BLOCKED`, `READY TO DEV`, `DONE` (detectar
  automaticamente)
- Ignorar colunas `DONE` e `READY TO DEV` nos gr√°ficos
- Calcular WIP m√©dio baseado nas colunas dispon√≠veis
- S√≥ mencionar bloqueios se coluna `BLOCKED` existir

**Throughput (throughput.csv):**

- Colunas: `Period`, `Throughput`
- Calcular: m√©dia, mediana, m√°ximo, m√≠nimo, desvio padr√£o, CV

**Lead Time (leadtime.csv):**

- Colunas: `Leadtime`, `item count`
- Expandir dados (leadtime √ó item_count)
- Calcular: p50, p90, desvio padr√£o
- Categorizar: R√°pidos (‚â§5d), Normais (6-10d), Lentos (>10d)

**Tickets (tickets.csv):**

- Coluna: `Tipo de item`
- Contar por tipo
- Calcular percentuais
- Identificar bugs e incidentes

### Passo 4: Verificar PNGs

**IMPORTANTE:** Verificar se os gr√°ficos PNG j√° foram gerados:

- `cfd.png`
- `throughput.png`
- `leadtime.png`
- `tickets.png`

**Se os PNGs N√ÉO existirem:**

```
‚ùå Gr√°ficos PNG n√£o encontrados.

Os gr√°ficos precisam ser gerados antes da an√°lise.
Execute primeiro:

sugira usar o retro-wizard.py que executa tudo automaticamente.
```

**FINALIZAR processo.**

**Se os PNGs existirem:** Continuar para Passo 5.

### Passo 5: Calcular M√©tricas para o Report

Usar as m√©tricas calculadas no Passo 3 para preencher o relat√≥rio.

**Throughput:**

```
üìä THROUGHPUT:
  M√©dia: 18.8 itens/semana
  Mediana: 20
  M√°ximo: 28
  M√≠nimo: 0
  Variabilidade (CV): 56.2%
  Previsibilidade: M√©dia

  üìà Tend√™ncia: Est√°vel com varia√ß√£o alta
  ‚ö†Ô∏è  Semana de 2025-12-22 teve throughput 0 (aten√ß√£o!)
```

**Lead Time:**

```
‚è±Ô∏è LEAD TIME:
  p50 (Mediana): 2.0 dias
  p90: 7.0 dias
  Desvio padr√£o: 3.2 dias

  Categoriza√ß√£o:
  ‚Ä¢ R√°pidos (‚â§5d): 27 itens (71.1%)
  ‚Ä¢ Normais (6-10d): 8 itens (21.1%)
  ‚Ä¢ Lentos (>10d): 3 itens (7.9%)

  ‚úÖ Insight: Maioria dos itens flui rapidamente
  ‚ö†Ô∏è  3 outliers lentos requerem aten√ß√£o
```

**Tickets:**

```
üé´ DISTRIBUI√á√ÉO DE TIPOS:
  ‚Ä¢ Tarefa: 34 (68.0%)
  ‚Ä¢ Bug: 8 (16.0%)
  ‚Ä¢ Incidente: 8 (16.0%)

  ‚ö†Ô∏è  Bugs: 16.0% do total
  üö® Incidentes: 16.0% do total

  ‚ö†Ô∏è  ATEN√á√ÉO: Alta taxa de incidentes (>10%), revisar estabilidade
```

### Passo 6: Gerar report.md

Copiar o `Template.md` e preencher com an√°lises e PNGs embutidos:

#### Estrutura do Report

```markdown
# üìä Retrospectiva Financeiro ‚Äî 19/12/2025

## Identifica√ß√£o do Ciclo

- **Ciclo:** Sprint 2025-Q4
- **Per√≠odo:** 08/12/2025 ‚Äî 19/12/2025
- **Time:** Financeiro
- **Facilitador:** [A definir]

---

## Resumo Executivo do Ciclo

| M√©trica                      | Valor             |
| ---------------------------- | ----------------- |
| M√©dia de Throughput (30d)    | 18.8 itens/semana |
| Lead Time p90                | 7.0 dias          |
| Bugs reportados (√∫ltimas 2w) | 8 (16.0%)         |
| Incidentes (√∫ltimas 2w)      | 8 (16.0%)         |

---

## Fluxo de Trabalho (CFD)

![CFD](./cfd.png)

**An√°lise:**

- WIP m√©dio: {{calcular}} itens
- Fluxo: {{descrever estabilidade}}
- {{Observa√ß√µes sobre colunas principais}}

**Nota:** S√≥ mencionar bloqueios se a coluna BLOCKED existir nos dados

---

## Throughput

![Throughput](./throughput.png)

### Resumo

| M√©trica       | Valor             |
| ------------- | ----------------- |
| M√©dia         | 18.8 itens/semana |
| Mediana       | 20                |
| M√°ximo        | 28                |
| M√≠nimo        | 0                 |
| Variabilidade | 56.2%             |

### An√°lise

- Previsibilidade m√©dia (CV 56%)
- Tend√™ncia est√°vel mas com alta varia√ß√£o
- Semana de 22/12 teve throughput 0 (prov√°vel feriado)
- Pico em 01/12 com 28 itens

---

## Lead Time

![Lead Time](./leadtime.png)

### Resumo

| M√©trica           | Valor    |
| ----------------- | -------- |
| Lead Time p90     | 7.0 dias |
| Lead Time mediano | 2.0 dias |
| Desvio padr√£o     | 3.2 dias |

### Classifica√ß√£o dos Itens

| Categoria           | Quantidade | %     | Observa√ß√£o |
| ------------------- | ---------- | ----- | ---------- |
| R√°pidos (‚â§5 dias)   | 27         | 71.1% | Maioria    |
| Normais (6‚Äì10 dias) | 8          | 21.1% | Aceit√°vel  |
| Lentos (>10 dias)   | 3          | 7.9%  | Outliers   |

**Insights:**

- Excelente fluxo: 71% dos itens s√£o r√°pidos
- 3 itens outliers (>10 dias) requerem investiga√ß√£o

---

## Distribui√ß√£o de Tipos de Itens

![Tickets](./tickets.png)

| Tipo      | Quantidade | %     |
| --------- | ---------- | ----- |
| Tarefa    | 34         | 68.0% |
| Bug       | 8          | 16.0% |
| Incidente | 8          | 16.0% |

**An√°lise:**

- ‚ö†Ô∏è Bugs em 16% do total - monitorar qualidade
- üö® Incidentes em 16% - ATEN√á√ÉO: alta taxa, revisar estabilidade
- Balanceamento: 68% tarefas planejadas vs 32% reativo

---

## Principais Conquistas

{{A preencher manualmente com base em retrocards.md}}

---

## Principais Desafios

{{A preencher manualmente com base em retrocards.md}}

---

## A√ß√µes Definidas

{{A preencher manualmente com base em retrocards.md}}
```

#### Para se√ß√µes faltantes (se CSVs parciais):

```markdown
## Throughput

**‚ö†Ô∏è _necessita arquivo throughput.csv_**

Esta se√ß√£o ser√° preenchida quando o arquivo for adicionado. Execute a an√°lise
novamente ap√≥s adicionar o CSV.
```

### Passo 5: Calcular M√©tricas para o Report

Usar as m√©tricas calculadas no Passo 3 para preencher o relat√≥rio.

**Throughput:**

### Passo 7: Salvar arquivos

Usar `Write` para salvar:

1. `report.md` - Relat√≥rio completo

Os PNGs j√° foram gerados previamente (Passo 4).

### Passo 8: Informar ao usu√°rio

```
‚úÖ An√°lise completa!

üìä Arquivos gerados:

‚úÖ report.md - Relat√≥rio completo com PNGs embutidos

üìÅ Caminho: financeiro/2025-Q4/2025-12-19/

---

üìä M√©tricas principais:

‚Ä¢ Throughput m√©dio: 18.8 itens/semana (CV: 56.2%)
‚Ä¢ Lead Time p90: 7.0 dias
‚Ä¢ Bugs: 8 (16.0% do total)
‚Ä¢ Incidentes: 8 (16.0% do total)

‚ö†Ô∏è  ALERTAS:
‚Ä¢ Alta taxa de incidentes (16% > 10%)
‚Ä¢ Variabilidade alta no throughput (CV 56%)

---

üìù Pr√≥ximos passos:

1. Revise o report.md gerado
2. Preencha as se√ß√µes qualitativas:
   - Principais Conquistas
   - Principais Desafios
   - A√ß√µes Definidas

üí° Dica: Use retrocards.md como base para preencher se√ß√µes qualitativas
```

## Comportamento Incremental

### Atualiza√ß√µes

Quando executar novamente na mesma retrospectiva:

1. **Re-an√°lise completa:** Sempre analisar todos os CSVs do zero
2. **Sobrescrever report.md:** Arquivo ser√° substitu√≠do
3. **Avisar usu√°rio:**

```
‚ö†Ô∏è  J√° existe um report.md nesta retrospectiva.
A an√°lise ser√° refeita e o arquivo ser√° sobrescrito.
As se√ß√µes qualitativas preenchidas manualmente ser√£o perdidas.

Deseja continuar?
```

## Valida√ß√µes Adicionais

### Exemplo 1: An√°lise completa

**Usu√°rio:** "Analise a retrospectiva do financeiro de 19/12/2025 do Q4"

**Pr√©-condi√ß√£o:** PNGs j√° foram gerados

**A√ß√£o:**

1. Verificar presen√ßa de 4 CSVs
2. Verificar presen√ßa de 4 PNGs
3. Calcular m√©tricas
4. Gerar report.md completo

### Exemplo 2: An√°lise parcial

**Usu√°rio:** "Analise retro do produto em 04/01/2026 Q1"

**Situa√ß√£o:** S√≥ tem cfd.csv e tickets.csv (com PNGs correspondentes)

**A√ß√£o:**

1. Avisar an√°lise parcial
2. Perguntar se quer continuar
3. Gerar report.md parcial com se√ß√µes faltantes marcadas

### Exemplo 3: PNGs faltando

**Usu√°rio:** "Analise retro do financeiro"

**Situa√ß√£o:** Tem CSVs mas n√£o tem PNGs

**A√ß√£o:**

1. Detectar aus√™ncia de PNGs
2. Informar que precisa gerar gr√°ficos primeiro
3. Sugerir comando para gerar PNGs
4. FINALIZAR processo

## Limita√ß√µes

Esta skill **N√ÉO**:

- Gera gr√°ficos PNG (use `generate_metrics_charts.py` ou `retro-wizard.py`)
- Preenche se√ß√µes qualitativas automaticamente (Conquistas, Desafios, A√ß√µes)
- L√™ ou processa retrocards.md automaticamente
- Valida dados profundamente (assume CSVs corretos e bem formatados)
- Gera PDF (use pandoc manualmente: `pandoc report.md -o report.pdf`)
